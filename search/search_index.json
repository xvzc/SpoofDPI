{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"developer-guide/build-and-run/","title":"Build and Run","text":"<p>This project utilizes <code>CGO</code> for low-level networking capabilities, requiring specific dependencies and build flags.</p>"},{"location":"developer-guide/build-and-run/#prerequisites","title":"Prerequisites","text":"<ul> <li>Go Version: Go 1.22 or higher is required.</li> <li>C Compiler: A C compiler (GCC or Clang) must be available on your system.</li> <li>Network Dependency: The project relies on the libpcap library for packet capture functionality. You must install the development headers for this library before building.</li> </ul>"},{"location":"developer-guide/build-and-run/#dependency-installation-examples","title":"Dependency Installation Examples","text":"Distribution Command Debian/Ubuntu <code>sudo apt update &amp;&amp; sudo apt install libpcap-dev</code> Fedora/RHEL <code>sudo dnf install libpcap-devel</code> macOS (Homebrew) <code>brew install libpcap</code>"},{"location":"developer-guide/build-and-run/#running-from-source-code","title":"Running from Source Code","text":"<p>To run the application without building an executable, use the standard <code>Go</code> command. Command-line arguments can be passed directly after the package path.</p> <pre><code>$ go run ./cmd/spoofdpi --https-chunk-size 1\n</code></pre>"},{"location":"developer-guide/build-and-run/#building-an-executable","title":"Building an Executable","text":"<p>To build the executable, ensure CGO is enabled and run the standard Go build command targeting the <code>/cmd</code> directory:</p> <pre><code>$ CGO_ENABLED=1 go build -ldflags=\"-w -s\" ./cmd/...\n</code></pre>"},{"location":"developer-guide/code-quality/","title":"Code Quality","text":"<p>This project utilizes golangci-lint as the single entry point for both code quality checks (linting) and style enforcement (formatting). This ensures consistent code standards across the entire project.</p> <pre><code>- Format the code (using internal tools like goimports, gofmt)\n$ golangci-lint fmt\n\n- Run all quality checks\n$ golangci-lint run\n</code></pre>"},{"location":"developer-guide/commit-messages/","title":"Commit Messages","text":"<p>This project adheres to the Conventional Commits specification to ensure a clear and standardized project history. Please follow the format below.</p> <pre><code>type(scope): description\n\n[optional body]\n\n[optional footer(s)]\n</code></pre> <p>Allowed valus for <code>&lt;type&gt;</code></p> <ul> <li>feat: A new feature</li> <li>fix: A bug fix</li> <li>docs: Documentation only changes</li> <li>style: Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)</li> <li>refactor: A code change that neither fixes a bug nor adds a feature</li> <li>perf: A code change that improves performance</li> <li>test: Adding missing tests or correcting existing tests</li> <li>chore: Other changes that don't modify src or test files</li> <li>ci: Changes to our CI configuration files and scripts</li> <li>revert: Reverts a previous commit</li> </ul>"},{"location":"developer-guide/documentation/","title":"Documentation","text":"<p>This project utilizes the Material for MkDocs theme as a static site generator for project documentation.</p>"},{"location":"developer-guide/documentation/#setup","title":"Setup","text":"<p>Install the necessary dependencies. We explicitly install the Material theme which should include MkDocs as a dependency.</p> <pre><code>$ pip install mkdocs-material\n</code></pre>"},{"location":"developer-guide/documentation/#local-development","title":"Local Development","text":"<p>All documentation source files are located in the <code>docs</code> directory, and the configuration file <code>mkdocs.yml</code> is located in the project root.</p> <p>To run the documentation site locally, execute the command below from the project root:</p> <pre><code>$ mkdocs serve\n</code></pre> <p>This command will start a development server (usually accessible at <code>http://127.0.0.1:8000</code>), which automatically reloads upon source file changes.</p>"},{"location":"developer-guide/testing/","title":"Testing","text":"<p>This document outlines how to run tests and the conventions for writing new tests in SpoofDPI.</p>"},{"location":"developer-guide/testing/#running-tests","title":"Running Tests","text":"<p>To run all tests in the project, use the standard <code>go test</code> command from the root directory:</p> <pre><code>$ go test ./...\n</code></pre> <p>To run tests with verbose output (showing all test names):</p> <pre><code>$ go test -v ./...\n</code></pre> <p>To run a specific test function (e.g., <code>TestCreateCommand_Flags</code>):</p> <pre><code>$ go test -v -run TestCreateCommand_Flags ./internal/config/\n</code></pre>"},{"location":"developer-guide/testing/#conventions","title":"Conventions","text":"<p>SpoofDPI uses the standard <code>testing</code> package enhanced by testify for assertions and requirements.</p>"},{"location":"developer-guide/testing/#1-framework","title":"1. Framework","text":"<ul> <li>Use <code>testify/assert</code> for general assertions where a failure should record an error but continue the test.</li> <li>Use <code>testify/require</code> for checks that must pass for the rest of the test to proceed (e.g., checking for errors after a function call, ensuring setup was successful).</li> </ul> <pre><code>import (\n    \"testing\"\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/require\"\n)\n\nfunc TestExample(t *testing.T) {\n    result, err := SomeFunction()\n\n    // Stop immediately if there's an error\n    require.NoError(t, err)\n\n    // Assert the result, but continue even if it fails\n    assert.Equal(t, \"expected\", result)\n}\n</code></pre>"},{"location":"developer-guide/testing/#2-table-driven-tests","title":"2. Table-Driven Tests","text":"<p>For testing multiple scenarios of the same logic, table-driven tests are strongly preferred. This keeps the test code clean and makes it easy to add new cases.</p> <pre><code>func TestCalculation(t *testing.T) {\n    tcs := []struct {\n        name     string\n        input    int\n        expected int\n    }{\n        {\n            name:     \"positive number\",\n            input:    5,\n            expected: 10,\n        },\n        {\n            name:     \"zero\",\n            input:    0,\n            expected: 0,\n        },\n    }\n\n    for _, tc := range tcs {\n        t.Run(tc.name, func(t *testing.T) {\n            result := calculate(tc.input)\n            assert.Equal(t, tc.expected, result)\n        })\n    }\n}\n</code></pre>"},{"location":"developer-guide/testing/#3-naming","title":"3. Naming","text":"<ul> <li>Test functions should start with <code>Test</code> followed by the name of the function or feature being tested (e.g., <code>TestCreateCommand</code>).</li> <li>Use clear and descriptive names for table-driven test cases (e.g., <code>name: \"default values (no flags)\"</code>).</li> </ul>"},{"location":"getting-started/install/","title":"Install","text":""},{"location":"getting-started/install/#requirements","title":"Requirements","text":"<p>SpoofDPI requires the libpcap library on all operating systems except Linux.</p> <pre><code>- macOS\n$ brew install libpcap \n\n- FreeBSD\n$ pkg install libpcap\n\n- Linux\n$ echo \"libpcap is not required on Linux\"\n\n- ...\n</code></pre>"},{"location":"getting-started/install/#install-using-script","title":"Install Using Script","text":"<p>You can install <code>spoofdpi</code> using the provided script. The binary will be installed to <code>/usr/local/bin</code>. <pre><code>$ curl -fsSL https://raw.githubusercontent.com/xvzc/SpoofDPI/main/install.sh | bash\n</code></pre></p>"},{"location":"getting-started/install/#install-with-package-manager","title":"Install With Package Manager","text":"<p>You can also install SpoofDPI using package managers of your choice, but note that the version may not be the latest, depending on the Packaging Status.</p> <pre><code>- macOS\n$ brew install spoofdpi\n\n- Arch Linux\n$ yay -S spoofdpi\n\n- Fedora\n$ sudo dnf install spoofdpi\n\n- FreeBSD\n$ pkg install spoofdpi\n\n- ...\n</code></pre>"},{"location":"getting-started/install/#manual-build","title":"Manual Build","text":"<p>To build SpoofDPI manually, ensure that you have a recent version of Go and the libpcap library installed.</p> <p>Note</p> <p>libpcap is no longer required on Linux, so <code>CGO</code> does not need to be enabled.</p>"},{"location":"getting-started/install/#git","title":"Git","text":"<p>If you are building manually from the latest commit, we recommend including the commit hash for better issue tracking.</p> <pre><code>#!/usr/bin/env sh\n\nBUILD_INFO=\"git\"\nSRC=\"SpoofDPI\"\nDIST=\"dist\"\n\nmkdir -p ./$DIST\n\ngit clone https://github.com/xvzc/SpoofDPI.git\n\nBUILD_LDFLAGS=\"-s -w\"\nBUILD_LDFLAGS=\"$BUILD_LDFLAGS -X 'main.commit=$(git -C ./$SRC rev-parse --short HEAD)'\"\nBUILD_LDFLAGS=\"$BUILD_LDFLAGS -X 'main.build=$BUILD_INFO'\"\n\n# You can disable CGO on Linux by setting `CGO_ENABLED=0`\nCGO_ENABLED=1 go build -C ./$SRC \\\n  -ldflags \"$BUILD_LDFLAGS\" \\\n  -o ../$DIST/spoofdpi ./cmd/spoofdpi\n</code></pre>"},{"location":"getting-started/install/#github-release","title":"GitHub Release","text":"<p>You can also build directly from the release source code. This is particularly useful for platforms where native GitHub Actions runners are unavailable (e.g., FreeBSD), requiring manual packaging.</p> <p>We recommend injecting version and build information during the build process to help maintainers track issues effectively.</p> <p>Every release includes a custom source archive (e.g., <code>spoofdpi-1.1.3.tar.gz</code>) which contains a <code>COMMIT</code> file. You can use this file to embed the commit hash into the binary. <pre><code>#!/usr/bin/env bash\n\nVERSION=\"#REPLACE_THIS_WITH_VERSION#\"\nBUILD_INFO=\"freebsd\"\nASSET=\"spoofdpi-$VERSION.tar.gz\"\nSRC=\"spoofdpi-$VERSION\"\nDIST=\"dist\"\n\ncurl -fsSL \\\n  https://github.com/xvzc/SpoofDPI/releases/download/v$VERSION/$ASSET \\\n  -o ./$ASSET\n\ntar -xvzf ./spoofdpi-$VERSION.tar.gz\n\nBUILD_LDFLAGS=\"-s -w\"\nBUILD_LDFLAGS=\"$BUILD_LDFLAGS -X 'main.version=$VERSION'\"\nBUILD_LDFLAGS=\"$BUILD_LDFLAGS -X 'main.commit=$(cat ./$SRC/COMMIT)'\"\nBUILD_LDFLAGS=\"$BUILD_LDFLAGS -X 'main.build=$BUILD_INFO'\"\n\n# You can disable CGO on Linux by setting `CGO_ENABLED=0`\nCGO_ENABLED=1 go build -C ./$SRC \\\n  -ldflags \"$BUILD_LDFLAGS\" \\\n  -o ../$DIST/spoofdpi ./cmd/spoofdpi\n</code></pre></p>"},{"location":"getting-started/install/#packaging-status","title":"Packaging Status","text":""},{"location":"getting-started/introduction/","title":"Introduction","text":""},{"location":"getting-started/introduction/#introduction","title":"Introduction","text":"<p>SpoofDPI is a lightweight, flexible tool designed to circumvent Deep Packet Inspection (DPI) through advanced packet manipulation. It is written in Go, supports cross-platform execution, and operates with minimal overhead.</p>"},{"location":"getting-started/introduction/#features","title":"Features","text":"<ul> <li>High Performance: Low latency achieved through the Go runtime and cache</li> <li>Built-in DNS Resolver: Use built-in DNS resolvers without a need to change system settings</li> <li>Flexible Policies: Robust policy rule support based on domains (allow/ignore)</li> <li>Easy Configuration: Simple setup via a TOML file</li> <li>Cross-Platform: Runs on macOS, Linux and FreeBSD</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>SpoofDPI provides a number of options to customize its behavior, and these options have default values. If it works as expected without customizing the option values, you can just run it as shown below. <pre><code>$ spoofdpi\n</code></pre></p> <p>If you can't get it working as expected, check User Guide for more information on customization.</p>"},{"location":"user-guide/dns/","title":"DNS Configuration","text":"<p>Settings controlling how domain names are resolved.</p>"},{"location":"user-guide/dns/#mode","title":"<code>mode</code>","text":"<p><code>type: string</code></p>"},{"location":"user-guide/dns/#description","title":"Description","text":"<p>Specifies the default resolution mode for domains that do not match any specific rule. <code>(default: \"udp\")</code></p>"},{"location":"user-guide/dns/#allowed-values","title":"Allowed Values","text":"<ul> <li><code>udp</code>: Standard DNS over UDP.</li> <li><code>https</code>: DNS over HTTPS (DoH).</li> <li><code>system</code>: Use the system's default resolver.</li> </ul>"},{"location":"user-guide/dns/#usage","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --dns-mode \"https\"\n</code></pre></p> <p>TOML Config <pre><code>[dns]\nmode = \"https\"\n</code></pre></p>"},{"location":"user-guide/dns/#addr","title":"<code>addr</code>","text":"<p><code>type: &lt;ip:port&gt;</code></p>"},{"location":"user-guide/dns/#description_1","title":"Description","text":"<p>Upstream DNS server address for standard UDP queries. <code>(default: 8.8.8.8:53)</code></p> <p>This is used when <code>dns-mode</code> is set to <code>udp</code>.</p>"},{"location":"user-guide/dns/#usage_1","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --dns-addr \"1.1.1.1:53\"\n</code></pre></p> <p>TOML Config <pre><code>[dns]\naddr = \"1.1.1.1:53\"\n</code></pre></p>"},{"location":"user-guide/dns/#https-url","title":"<code>https-url</code>","text":"<p><code>type: string</code></p>"},{"location":"user-guide/dns/#description_2","title":"Description","text":"<p>Endpoint URL for DNS over HTTPS (DoH) queries. <code>(default: \"https://dns.google/dns-query\")</code></p> <p>This is used when <code>dns-mode</code> is set to <code>https</code>.</p>"},{"location":"user-guide/dns/#usage_2","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --dns-https-url \"https://1.1.1.1/dns-query\"\n</code></pre></p> <p>TOML Config <pre><code>[dns]\nhttps-url = \"https://1.1.1.1/dns-query\"\n</code></pre></p>"},{"location":"user-guide/dns/#qtype","title":"<code>qtype</code>","text":"<p><code>type: string</code></p>"},{"location":"user-guide/dns/#description_3","title":"Description","text":"<p>Filters DNS queries by record type (A for IPv4, AAAA for IPv6). <code>(default: \"ipv4\")</code></p> <p>Available values are <code>\"ipv4\"</code>, <code>\"ipv6\"</code>, and <code>\"all\"</code>.</p> <p>If your Internet Service Provider (ISP) doesn't support IPv6, it is recommended to set this option to <code>\"ipv4\"</code> for stability.</p>"},{"location":"user-guide/dns/#usage_3","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --dns-qtype \"all\"\n</code></pre></p> <p>TOML Config <pre><code>[dns]\nqtype = \"all\"\n</code></pre></p>"},{"location":"user-guide/dns/#cache","title":"<code>cache</code>","text":"<p><code>type: boolean</code></p>"},{"location":"user-guide/dns/#description_4","title":"Description","text":"<p>If set, DNS records will be cached to improve performance and reduce latency. <code>(default: false)</code></p>"},{"location":"user-guide/dns/#usage_4","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --dns-cache\n</code></pre></p> <p>TOML Config <pre><code>[dns]\ncache = true\n</code></pre></p>"},{"location":"user-guide/examples/","title":"Configuration Examples","text":"<p>This page provides various configuration examples to help you set up SpoofDPI for different scenarios.</p>"},{"location":"user-guide/examples/#basic-setup","title":"Basic Setup","text":"<p>A minimal configuration to get started with DNS over HTTPS (DoH) and basic DPI bypass.</p> <pre><code>[dns]\n    mode = \"https\"\n    https-url = \"https://dns.google/dns-query\"\n</code></pre>"},{"location":"user-guide/examples/#aggressive-bypass","title":"Aggressive Bypass","text":"<p>If the default settings are not enough, you can try more aggressive settings. This configuration uses multiple fake packets and disorders the Client Hello.</p> <pre><code>[https]\n    fake-count = 5\n    fake-packet = [0x16, 0x03, 0x01] # Simple fake Client Hello prefix\n    disorder = true\n    split-mode = \"chunk\"\n    chunk-size = 1\n</code></pre>"},{"location":"user-guide/examples/#rule-based-routing","title":"Rule-Based Routing","text":"<p>Route traffic differently based on the domain or IP address.</p> <pre><code>[policy]\n    # Block ads\n    [[policy.overrides]]\n        name = \"block ads\"\n        match = { domain = \"ads.example.com\" }\n        block = true\n\n    # Bypass DPI for specific blocked site\n    [[policy.overrides]]\n        name = \"unblock site\"\n        match = { domain = \"blocked-site.com\" }\n        https = { fake-count = 7, disorder = true }\n\n    # Use local network directly (no processing)\n    [[policy.overrides]]\n        name = \"local bypass\"\n        match = { cidr = \"192.168.0.0/16\", port = \"all\" }\n        https = { skip = true }\n</code></pre>"},{"location":"user-guide/examples/#automatic-detection","title":"Automatic Detection","text":"<p>Let SpoofDPI automatically detect blocked sites and apply a specific template.</p> <pre><code>[policy]\n    auto = true\n\n    # Template applied to automatically detected blocked sites\n    [policy.template]\n        https = { fake-count = 7, disorder = true }\n</code></pre>"},{"location":"user-guide/general/","title":"General Configuration","text":"<p>General settings for the application, including logging and system integration.</p>"},{"location":"user-guide/general/#log-level","title":"<code>log-level</code>","text":"<p><code>type: string</code></p>"},{"location":"user-guide/general/#description","title":"Description","text":"<p>Specifies the logging verbosity.</p> <p>Available values are <code>debug</code>, <code>trace</code>, <code>info</code>, <code>warn</code>, <code>error</code>, and <code>disabled</code>. <code>(default: \"info\")</code></p>"},{"location":"user-guide/general/#usage","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --log-level trace\n</code></pre></p> <p>TOML Config <pre><code>[general]\nlog-level = \"trace\"\n</code></pre></p>"},{"location":"user-guide/general/#silent","title":"<code>silent</code>","text":"<p><code>type: boolean</code></p>"},{"location":"user-guide/general/#description_1","title":"Description","text":"<p>Suppresses the ASCII art banner at startup. <code>(default: false)</code></p>"},{"location":"user-guide/general/#usage_1","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --silent\n</code></pre></p> <p>TOML Config <pre><code>[general]\nsilent = true\n</code></pre></p>"},{"location":"user-guide/general/#system-proxy","title":"<code>system-proxy</code>","text":"<p><code>type: boolean</code></p>"},{"location":"user-guide/general/#description_2","title":"Description","text":"<p>Specifies whether to automatically set up the system-wide proxy configuration. <code>(default: false)</code></p> <p>Important</p> <p>This option is currently only supported on macOS.</p>"},{"location":"user-guide/general/#usage_2","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --system-proxy\n</code></pre></p> <p>TOML Config <pre><code>[general]\nsystem-proxy = true\n</code></pre></p>"},{"location":"user-guide/general/#config","title":"<code>config</code>","text":"<p><code>type: string</code></p>"},{"location":"user-guide/general/#description_3","title":"Description","text":"<p>Specifies the path to a custom <code>TOML</code> config file. <code>(default: none)</code></p> <p>If this option is set, SpoofDPI will not search the default directories.</p>"},{"location":"user-guide/general/#usage_3","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --config ~/spoofdpi.toml\n</code></pre></p> <p>TOML Config <pre><code># This option is not available in TOML config\n</code></pre></p>"},{"location":"user-guide/general/#clean","title":"<code>clean</code>","text":"<p><code>type: boolean</code></p>"},{"location":"user-guide/general/#description_4","title":"Description","text":"<p>Specifies whether to ignore all configuration files and run with default settings. <code>(default: false)</code></p>"},{"location":"user-guide/general/#usage_4","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --clean\n</code></pre></p> <p>TOML Config <pre><code># This option is not available in TOML config\n</code></pre></p>"},{"location":"user-guide/general/#version","title":"<code>version</code>","text":"<p><code>type: boolean</code></p>"},{"location":"user-guide/general/#description_5","title":"Description","text":"<p>Prints the version string and exits. <code>(default: false)</code></p>"},{"location":"user-guide/general/#usage_5","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --version\n</code></pre></p> <p>TOML Config <pre><code># This option is not available in TOML config\n</code></pre></p>"},{"location":"user-guide/https/","title":"HTTPS Configuration","text":"<p>Settings for manipulating HTTPS/TLS packets to bypass DPI.</p>"},{"location":"user-guide/https/#split-mode","title":"<code>split-mode</code>","text":"<p><code>type: string</code></p>"},{"location":"user-guide/https/#description","title":"Description","text":"<p>Specifies the default packet fragmentation strategy to use for the Client Hello packet. <code>(default: \"chunk\")</code></p>"},{"location":"user-guide/https/#allowed-values","title":"Allowed Values","text":"<ul> <li><code>sni</code>: Splits the packet right after the SNI extension.</li> <li><code>random</code>: Splits the packet at a random position.</li> <li><code>chunk</code>: Splits the packet into fixed-size chunks (controlled by <code>https-chunk-size</code>).</li> <li><code>first-byte</code>: Splits only the first byte of the packet.</li> <li><code>none</code>: Disables fragmentation.</li> </ul>"},{"location":"user-guide/https/#usage","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --https-split-mode sni\n</code></pre></p> <p>TOML Config <pre><code>[https]\nsplit-mode = \"sni\"\n</code></pre></p>"},{"location":"user-guide/https/#chunk-size","title":"<code>chunk-size</code>","text":"<p><code>type: uint8</code></p>"},{"location":"user-guide/https/#description_1","title":"Description","text":"<p>Specifies the chunk size in bytes for packet fragmentation. <code>(default: 0, max: 255)</code></p> <p>This value is only applied when <code>https-split-mode</code> is set to <code>chunk</code>. Try lower values if the default fails to bypass the DPI.</p>"},{"location":"user-guide/https/#usage_1","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --https-chunk-size 1\n</code></pre></p> <p>TOML Config <pre><code>[https]\nchunk-size = 1\n</code></pre></p>"},{"location":"user-guide/https/#disorder","title":"<code>disorder</code>","text":"<p><code>type: boolean</code></p>"},{"location":"user-guide/https/#description_2","title":"Description","text":"<p>Specifies whether to disorder fragmented Client Hello packets. <code>(default: false)</code></p> <p>When enabled, this option varies the TTL of fragmented Client Hello packets, potentially causing them to arrive out of order. This complicates the packet reassembly process for DPI systems.</p> <p>Note</p> <p>If <code>https-chunk-size</code> is <code>0</code> and split mode is <code>none</code>, disordering does not occur.</p>"},{"location":"user-guide/https/#usage_2","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --https-disorder\n</code></pre></p> <p>TOML Config <pre><code>[https]\ndisorder = true\n</code></pre></p>"},{"location":"user-guide/https/#fake-count","title":"<code>fake-count</code>","text":"<p><code>type: uint8</code></p>"},{"location":"user-guide/https/#description_3","title":"Description","text":"<p>Specifies the number of fake packets to be sent before the actual Client Hello. <code>(default: 0)</code></p> <p>Sending fake packets can trick DPI systems into inspecting invalid traffic, allowing the real Client Hello to pass through. If <code>https-chunk-size</code> is greater than 0, each fake packet will also be fragmented.</p> <p>Note</p> <p>SpoofDPI must be run with root privileges to use this option effectively on some systems or configurations requiring raw socket access (though usually not required for standard usage, verify if this note from old docs is still accurate - kept for safety).</p>"},{"location":"user-guide/https/#usage_3","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --https-fake-count 7\n</code></pre></p> <p>TOML Config <pre><code>[https]\nfake-count = 7\n</code></pre></p>"},{"location":"user-guide/https/#fake-packet","title":"<code>fake-packet</code>","text":"<p><code>type: byte array</code></p>"},{"location":"user-guide/https/#description_4","title":"Description","text":"<p>Customizes the content of the fake packets used by <code>https-fake-count</code>. <code>(default: built-in fake packet)</code></p> <p>The value should be a sequence of bytes representing a valid (or semi-valid) TLS Client Hello or other protocol data.</p>"},{"location":"user-guide/https/#usage_4","title":"Usage","text":"<p>Command-Line Flag Provide a comma-separated string of hexadecimal bytes (e.g., <code>16,03,01,...</code>).</p> <pre><code>$ spoofdpi --https-fake-packet \"16,03,01,00,a1,...\"\n</code></pre> <p>TOML Config Provide an array of integers (bytes).</p> <pre><code>[https]\nfake-packet = [0x16, 0x03, 0x01, 0x00]\n</code></pre>"},{"location":"user-guide/https/#skip","title":"<code>skip</code>","text":"<p><code>type: boolean</code></p>"},{"location":"user-guide/https/#description_5","title":"Description","text":"<p>If set to <code>true</code>, HTTPS traffic will be processed without any DPI bypass techniques (fragmentation, disordering, etc.). It effectively treats the connection as a standard HTTPS proxy connection.</p>"},{"location":"user-guide/https/#usage_5","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --https-skip\n</code></pre></p> <p>TOML Config <pre><code>[https]\nskip = true\n</code></pre></p>"},{"location":"user-guide/overview/","title":"Overview","text":"<p>There are two methods to configure SpoofDPI, and both can be used together.</p> <ul> <li>TOML Config File</li> <li>Command-Line Flags</li> </ul>"},{"location":"user-guide/overview/#configuration-priority","title":"Configuration Priority","text":"<p>SpoofDPI applies settings in the following order:</p> <ol> <li>Values defined in the TOML config file</li> <li>Values passed via command-line (CLI) flags</li> </ol> <p>Command-line flags will always override values set in the TOML config file. For example, if <code>config.toml</code> contains <code>listen-addr = \"127.0.0.1:8080\"</code>, but the user runs <code>$ spoofdpi --listen-addr :9090</code>, the <code>:9090</code> port will be used.</p>"},{"location":"user-guide/overview/#config-file-path","title":"Config File Path","text":"<p>If a specific path is not provided via a <code>--config</code> flag, SpoofDPI will search for <code>spoofdpi.toml</code> in the following locations in order, applying only the first file found:</p> <ul> <li><code>$SPOOFDPI_CONFIG</code> environment variable</li> <li><code>/etc/spoofdpi.toml</code></li> <li><code>$XDG_CONFIG_HOME/spoofdpi/spoofdpi.toml</code></li> <li><code>$HOME/.config/spoofdpi/spoofdpi.toml</code></li> </ul>"},{"location":"user-guide/overview/#options","title":"Options","text":"<p>The configuration is organized into five main categories. Click on each category to view detailed options.</p> Category Description General General application options (logging, system proxy, etc.). Server Server connection options (address, timeout). DNS DNS resolution options. HTTPS HTTPS/TLS packet manipulation options. Policy Rule-based routing and automatic bypass policies."},{"location":"user-guide/overview/#example","title":"Example","text":"<p>The following two methods will achieve the exact same configuration.</p>"},{"location":"user-guide/overview/#method-1-using-command-line-flags","title":"Method 1: Using Command-Line Flags","text":"<p>All settings are passed directly via flags.</p> <pre><code>$ spoofdpi --dns-addr \"1.1.1.1:53\" --dns-https-url \"https://dns.google/dns-query\" --dns-mode \"https\"\n</code></pre>"},{"location":"user-guide/overview/#method-2-using-a-toml-config-file","title":"Method 2: Using a TOML Config File","text":"<p>Place the settings in your <code>spoofdpi.toml</code> file:</p> <pre><code>[dns]\n    addr = \"1.1.1.1:53\"\n    https-url = \"https://dns.google/dns-query\"\n    mode = \"https\"\n</code></pre> <p>Then, run spoofdpi without those flags (it will automatically load the file if placed in a standard path):</p> <pre><code>$ spoofdpi\n</code></pre>"},{"location":"user-guide/policy/","title":"Policy Configuration","text":"<p>By defining rules within the Policy section, you can granularly control how SpoofDPI handles connections to specific domains or IP addresses. You can define per-domain bypass strategies, DNS settings, or simply block connections.</p>"},{"location":"user-guide/policy/#auto","title":"<code>auto</code>","text":"<p><code>type: boolean</code></p>"},{"location":"user-guide/policy/#description","title":"Description","text":"<p>Automatically detect blocked sites and add them to the bypass list. <code>(default: false)</code></p> <p>When enabled, SpoofDPI attempts to detect if a connection is being blocked and temporarily applies bypass rules for that destination. These generated rules utilize the configuration defined in <code>[policy.template]</code>.</p>"},{"location":"user-guide/policy/#usage","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --policy-auto\n</code></pre></p> <p>TOML Config <pre><code>[policy]\nauto = true\n</code></pre></p>"},{"location":"user-guide/policy/#template","title":"<code>template</code>","text":"<p>The <code>[policy.template]</code> section defines the default behavior for rules automatically generated when <code>auto = true</code>. If you enable automatic detection, you should configure this template to ensure the generated rules effectively bypass the DPI.</p> <p>Note</p> <p>The template configuration is only available via the TOML config file.</p>"},{"location":"user-guide/policy/#structure","title":"Structure","text":"<p>The template uses the same <code>Rule</code> structure as overrides, but typically only the <code>https</code> and <code>dns</code> sections are relevant, as the <code>match</code> criteria are determined dynamically.</p>"},{"location":"user-guide/policy/#example","title":"Example","text":"<pre><code>[policy]\n    auto = true\n\n    # This configuration is applied to automatically detected blocked sites\n    [policy.template]\n        https = { fake-count = 7, disorder = true }\n</code></pre>"},{"location":"user-guide/policy/#overrides","title":"<code>overrides</code>","text":"<p>Detailed policy rules are defined in the <code>[policy]</code> section of the TOML configuration file.</p> <p>Note</p> <p>These advanced rules are only available via the TOML config file and cannot be set via command-line flags.</p>"},{"location":"user-guide/policy/#structure_1","title":"Structure","text":"<p>The <code>[policy]</code> section contains an array of <code>overrides</code> tables. Each override rule consists of matching criteria (<code>match</code>) and specific settings for DNS (<code>dns</code>) and HTTPS (<code>https</code>).</p>"},{"location":"user-guide/policy/#rule-fields","title":"Rule Fields","text":"Field Type Description <code>name</code> String A descriptive name for the rule. <code>priority</code> Int Order of precedence. Higher numbers take priority. <code>block</code> Bool If <code>true</code>, completely blocks connections matching this rule."},{"location":"user-guide/policy/#match-criteria-match","title":"Match Criteria (<code>match</code>)","text":"<p>You must specify either a <code>domain</code> or a <code>cidr</code> (with <code>port</code>).</p> Field Type Description <code>domain</code> String Domain pattern. Supports wildcards (<code>*</code>, <code>**</code>). <code>cidr</code> String IP range in CIDR notation (e.g., <code>192.168.0.0/24</code>). Requires <code>port</code> to be set. <code>port</code> String Port or port range (e.g., <code>80</code>, <code>80-443</code>, <code>all</code>). Required if <code>cidr</code> is used."},{"location":"user-guide/policy/#dns-override-dns","title":"DNS Override (<code>dns</code>)","text":"<p>Customize how domain names are resolved for matched traffic. The available fields mirror the global DNS Configuration.</p> Field Type Description <code>mode</code> String Resolver to use: <code>\"udp\"</code>, <code>\"https\"</code> (DoH), or <code>\"system\"</code>. <code>addr</code> String Custom upstream server (e.g., <code>8.8.8.8:53</code>). <code>https-url</code> String Custom DoH URL (e.g., <code>https://dns.google/dns-query</code>). <code>qtype</code> String Query type: <code>\"ipv4\"</code>, <code>\"ipv6\"</code>, or <code>\"all\"</code>. <code>cache</code> Bool If <code>true</code>, enables caching for this rule."},{"location":"user-guide/policy/#https-override-https","title":"HTTPS Override (<code>https</code>)","text":"<p>Customize how HTTPS connections are established. The available fields mirror the global HTTPS Configuration.</p> Field Type Description <code>disorder</code> Bool Send Client Hello packets out of order. <code>fake-count</code> Int Number of fake packets to send. <code>fake-packet</code> Array List of bytes for the fake packet (e.g., <code>[0x16]</code>). <code>split-mode</code> String Split strategy: <code>\"chunk\"</code>, <code>\"sni\"</code>, <code>\"random\"</code>, etc. <code>chunk-size</code> Int Size of chunks when <code>split-mode</code> is <code>\"chunk\"</code>. <code>skip</code> Bool If <code>true</code>, bypasses DPI modifications (standard TLS)."},{"location":"user-guide/policy/#example_1","title":"Example","text":"<pre><code>[policy]\n    # Example A: Allow YouTube with specific DPI bypass settings\n    [[policy.overrides]]\n        name = \"allow youtube\"\n        priority = 50\n        match = { domain = \"*.youtube.com\" }\n        https = { disorder = true, fake-count = 7 }\n\n    # Example B: Bypass DPI for local network traffic (Standard Connection)\n    [[policy.overrides]]\n        name = \"skip local\"\n        priority = 51\n        match = { cidr = \"192.168.0.0/24\", port = \"all\" }\n        https = { skip = true }\n\n    # Example C: Block a specific domain\n    [[policy.overrides]]\n        name = \"block ads\"\n        priority = 100\n        match = { domain = \"ads.example.com\" }\n        block = true\n</code></pre>"},{"location":"user-guide/server/","title":"Server Configuration","text":"<p>Settings related to the proxy server connection and listener.</p>"},{"location":"user-guide/server/#listen-addr","title":"<code>listen-addr</code>","text":"<p><code>type: &lt;ip:port&gt;</code></p>"},{"location":"user-guide/server/#description","title":"Description","text":"<p>Specifies the IP address and port to listen on. <code>(default: 127.0.0.1:8080)</code></p> <p>If you want to run SpoofDPI remotely (e.g., on a physically separated machine), set the IP part to <code>0.0.0.0</code>. Otherwise, it is recommended to leave this option as default for security.</p>"},{"location":"user-guide/server/#usage","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --listen-addr \"0.0.0.0:8080\"\n</code></pre></p> <p>TOML Config <pre><code>[server]\nlisten-addr = \"0.0.0.0:8080\"\n</code></pre></p>"},{"location":"user-guide/server/#timeout","title":"<code>timeout</code>","text":"<p><code>type: uint16</code></p>"},{"location":"user-guide/server/#description_1","title":"Description","text":"<p>Specifies the timeout (in milliseconds) for every TCP connection. <code>(default: 0, max: 65535)</code></p> <p>A value of <code>0</code> means no timeout. You can set this option if you know what you are doing, but in most cases, leaving this option unset is recommended.</p>"},{"location":"user-guide/server/#usage_1","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --timeout 5000\n</code></pre></p> <p>TOML Config <pre><code>[server]\ntimeout = 5000\n</code></pre></p>"},{"location":"user-guide/server/#default-ttl","title":"<code>default-ttl</code>","text":"<p><code>type: uint8</code></p>"},{"location":"user-guide/server/#description_2","title":"Description","text":"<p>Specifies the default Time To Live (TTL) value for outgoing packets. <code>(default: 64)</code></p> <p>This value is used to restore the TTL to its default state after applying disorder strategies. Changing this option is generally not required.</p> <p>Note</p> <p>The default TTL value for macOS and Linux is usually <code>64</code>.</p>"},{"location":"user-guide/server/#usage_2","title":"Usage","text":"<p>Command-Line Flag <pre><code>$ spoofdpi --default-ttl 128\n</code></pre></p> <p>TOML Config <pre><code>[server]\ndefault-ttl = 128\n</code></pre></p>"},{"location":"user-guide/configuration-recipes/south-korea/","title":"South Korea","text":"<pre><code># TOML config\nhttps-chunk-size = 1\nhttps-fake-count = 10\npolicy = [\n    \"i:*.pornhub.com\",\n    \"i:*.womenonweb.org\",\n]\n</code></pre>"}]}